<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kh.semi.mappers.BoardMapper">
    <resultMap id="boardResult" type="Board">
        <result column="BOARD_NO" property="boardNo" />
        <result column="TITLE" property="title" />
        <result column="CONTENT" property="content" />
        <result column="CREATE_DATE" property="createDate" />
        <result column="COUNT" property="count" />
        <result column="BRANCH" property="branch" />
        <result column="TYPE" property="type" />
        <result column="CHANGE_NAME" property="changeName" />
        <result column="ORIGIN_NAME" property="originName" />
        <result column="USER_NO" property="userNo" />
        <result column="CLASS_NO" property="classNo" />
        <result column="BOARD_STATUS" property="status"/>
        <result column="USER_NAME" property="userName" />
    </resultMap>

    <select id="selectBoardCount" resultType="_int">
        SELECT COUNT(*)
        FROM TB_BOARD
        WHERE BOARD_STATUS = 'Y'
    </select>

    <select id="selectNoticeBoardList" resultMap="boardResult">
        SELECT BOARD_NO,
        BRANCH,
        TITLE,
        U.USER_NAME,
        COUNT,
        TO_CHAR(CREATE_DATE, 'YYYY-MM-DD') AS CREATE_DATE
        FROM TB_BOARD
        JOIN TB_USER U USING (USER_NO)
        WHERE TYPE = 1
          AND BOARD_STATUS = 'Y'
        ORDER BY BOARD_NO DESC
    </select>

    <insert id="insertNoticeBoard" parameterType="Board">
        INSERT INTO TB_BOARD (
        BOARD_NO,
        TITLE,
        CONTENT,
        BRANCH,
        TYPE,
        ORIGIN_NAME,
        CHANGE_NAME,
        USER_NO,
        CLASS_NO
        ) VALUES (
        SEQ_BOARD_NO.NEXTVAL,
        #{title},
        #{content},
        #{branch},
        1,
        #{originName},
        #{changeName},
        #{userNo},
        NULL
        )
    </insert>

    <update id="increaseNoticeCount">
        UPDATE TB_BOARD
        SET COUNT = COUNT + 1
        WHERE BOARD_NO = #{bno}
        AND BOARD_STATUS = 'Y'
    </update>

    <select id="selectNoticeBoard" resultMap="boardResult">
        SELECT BOARD_NO,
               TITLE,
               BRANCH,
               U.USER_NAME,
               CONTENT,
               ORIGIN_NAME,
               CHANGE_NAME,
               COUNT,
               TO_CHAR(CREATE_DATE, 'YYYY-MM-DD') AS CREATE_DATE
          FROM TB_BOARD
          JOIN TB_USER U USING (USER_NO)
         WHERE BOARD_STATUS = 'Y'
           AND BOARD_NO = #{bno}
    </select>

    <update id="updateNoticeBoard" >
        UPDATE BOARD
        SET TITLE = #{title},
            CONTENT = #{content},
            BRANCH = #{branch}m
            ORIGIN_NAME = #{originName},
            CHANGE_NAME = #{changeName}
        WHERE BOARD_NO = #{boardNo}
    </update>

</mapper>
